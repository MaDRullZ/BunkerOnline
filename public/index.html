<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ë—É–Ω–∫–µ—Ä –û–Ω–ª–∞–π–Ω üåë</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>
<h1>–ë—É–Ω–∫–µ—Ä –û–Ω–ª–∞–π–Ω üåë</h1>

<div>
  <input id="name" placeholder="–í–∞—à–µ –∏–º—è">
  <button id="create">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
  <input id="roomId" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
  <button id="join">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
</div>

<div id="lobby"></div>
<div id="map"></div>

<script>
const socket = io("https://bunkeronline.onrender.com");

document.getElementById("create").onclick = () => socket.emit("createRoom");
document.getElementById("join").onclick = () => {
  socket.emit("joinRoom", { roomId: document.getElementById("roomId").value, name: document.getElementById("name").value });
};

socket.on("roomCreated", roomId => alert("–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞: " + roomId));
socket.on("roomUpdate", players => {
  document.getElementById("lobby").innerHTML = players.map(p => p.name + " (" + p.role + ")").join("<br>");
});
socket.on("gameStarted", room => {
  const map = document.getElementById("map");
  map.innerHTML = "";
  room.state.sections.forEach(sec => {
    const div = document.createElement("div");
    div.className = "section normal";
    div.textContent = sec.name;
    div.onclick = () => alert(`–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${sec.integrity}%`);
    map.appendChild(div);
    if(sec.integrity < 40) div.className = "section critical";
    else if(sec.integrity < 70) div.className = "section warning";
  });
});
</script>
</body>
</html>
