<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Bunker Online</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <div class="container" id="menuScreen">
    <h1>Bunker Online</h1>
    <button id="createRoomBtn">Создать комнату</button>
    <div>
      <input type="text" id="roomInput" placeholder="Введите код комнаты">
      <button id="joinRoomBtn">Присоединиться</button>
    </div>
    <div id="status"></div>
  </div>

  <div class="container" id="gameScreen" style="display:none;">
    <h2>Игра началась!</h2>
    <div id="roomInfo"></div>
    <div id="playersList"></div>
  </div>

  <script>
    const socket = io();

    const menuScreen = document.getElementById("menuScreen");
    const gameScreen = document.getElementById("gameScreen");
    const statusDiv = document.getElementById("status");
    const roomInfo = document.getElementById("roomInfo");
    const playersList = document.getElementById("playersList");

    document.getElementById("createRoomBtn").addEventListener("click", () => {
      socket.emit("createRoom", (roomCode) => {
        statusDiv.innerHTML = `Комната создана! Код: <b>${roomCode}</b>`;
        menuScreen.style.display = "none";
        gameScreen.style.display = "block";
      });
    });

    document.getElementById("joinRoomBtn").addEventListener("click", () => {
      const roomCode = document.getElementById("roomInput").value.toUpperCase();
      socket.emit("joinRoom", roomCode, (success) => {
        if(success) {
          statusDiv.innerHTML = `Вы присоединились к комнате <b>${roomCode}</b>`;
          menuScreen.style.display = "none";
          gameScreen.style.display = "block";
        } else {
          statusDiv.innerHTML = `<span style="color:red">Комната не найдена!</span>`;
        }
      });
    });

    socket.on("updateRoom", (roomData) => {
      roomInfo.innerHTML = `<b>Катастрофа:</b> ${roomData.disaster} <br> Код комнаты: ${Object.keys(roomData)[0]}`;
      playersList.innerHTML = "<b>Игроки:</b><br>" + roomData.players.map(p => `
        ${p.name} | Сумка: ${p.bag} | Фобия: ${p.phobia} | Здоровье: ${p.health} | Хобби: ${p.hobby} | Черта: ${p.trait}
      `).join("<br>");
    });
  </script>
</body>
</html>
